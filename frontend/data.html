<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data & Register</title>
  <script src="https://unpkg.com/face-api.js@0.22.2/dist/face-api.min.js"></script>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Nav -->
  <nav>
    <div class="nav-container">
      <h1 data-i18n="nav_title">Face Attendance System</h1>
      <ul>
        <li><a href="data.html" data-i18n="nav_data_register">Data & Register</a></li>
        <li><a href="attendance.html" data-i18n="nav_attendance">Take Attendance</a></li>
        <li><a href="batch.html" data-i18n="nav_batch">Batch Processing</a></li>
        <li><a href="reports.html" data-i18n="nav_reports">Reports</a></li>
        <li><a href="statistics.html" data-i18n="nav_statistics">Statistics</a></li>
      </ul>
    </div>
  </nav>

  <main>
    <div id="data-page" class="page">
      <h2 data-i18n="data_title">Data Management</h2>

      <!-- Face Registration -->
      <section class="data-section">
        <h3 data-i18n="data_face_reg_title">Face Registration</h3>
        <div class="form-group">
          <label for="student-class" data-i18n="register_class">Class:</label>
          <input type="text" id="student-class" placeholder="e.g., Grade 10A">
        </div>
        <div class="form-group">
          <label for="student-name" data-i18n="register_name">Name:</label>
          <input type="text" id="student-name" placeholder="e.g., Alice Smith">
        </div>
        <div class="form-group">
          <label for="student-course" data-i18n="register_course">Course:</label>
          <input type="text" id="student-course" placeholder="e.g., Physics">
        </div>
        <div class="form-group">
          <button onclick="startWebcamRegistration()" data-i18n="register_webcam_btn">Start Webcam Registration</button>
          <input type="file" id="image-upload" accept="image/*" onchange="registerFromImage()">
          <span class="hint" data-i18n="hint_register_image">You can also upload a single image to register.</span>
        </div>
        <video id="registration-video" autoplay muted></video>
        <canvas id="registration-canvas"></canvas>
        <button id="capture-btn" onclick="captureFace()" style="display: none;" data-i18n="register_capture_btn">Capture Face</button>
      </section>

      <!-- Students -->
      <section class="data-section">
        <h3 data-i18n="data_students_title">Students</h3>
        <div class="form-group">
          <label for="student-folder" data-i18n="label_student_folder">Import from Folder (文件夹导入):</label>
          <input type="file" id="student-folder" webkitdirectory directory multiple accept=".jpg,.jpeg,.png">
          <button onclick="importStudentsFromFolder()" data-i18n="btn_import_students">Import Students</button>
          <p class="hint" data-i18n="hint_student_folder">How to use: Click “Choose Folder” and select the folder containing student photos. Filename format: 学号-姓名.jpg/png, e.g. 20230001-张三.jpg</p>
        </div>
        <div class="form-group">
          <label data-i18n="label_manual_create">Manual Create:</label>
          <input type="text" id="student-number-input" placeholder="学号 (student number)">
          <input type="text" id="student-name-input" placeholder="姓名 (name)">
          <select id="student-gender-input">
            <option value="" data-i18n="placeholder_gender">性别 (gender)</option>
            <option value="male" data-i18n="gender_male">男</option>
            <option value="female" data-i18n="gender_female">女</option>
            <option value="other" data-i18n="gender_other">其他</option>
          </select>
          <button onclick="submitNewStudent()" data-i18n="btn_create_student">Create Student</button>
          <p class="hint" data-i18n="hint_student_note">Note: Students support folder import by filename format; no Excel import is required.</p>
        </div>
      </section>

      <!-- Courses -->
      <section class="data-section">
        <h3 data-i18n="data_courses_title">Courses</h3>
        <div class="form-group">
          <label for="courses-excel" data-i18n="label_courses_excel">Import from Excel (课程编号/课程名称/课程学时):</label>
          <input type="file" id="courses-excel" accept=".xls,.xlsx">
          <button onclick="importCoursesFromExcel()" data-i18n="btn_import_courses">Import Courses</button>
          <p class="hint" data-i18n="hint_course_excel">Excel columns required: 课程编号, 课程名称, 课程学时. English headers also supported: course_code, course_name, course_hours.</p>
        </div>
        <div class="form-group">
          <label data-i18n="label_manual_create">Manual Create:</label>
          <input type="text" id="course-code-input" placeholder="课程编号 (course code)">
          <input type="text" id="course-name-input" placeholder="课程名称 (course name)">
          <input type="number" id="course-hours-input" placeholder="课程学时 (course hours)">
          <button onclick="submitNewCourse()" data-i18n="btn_create_course">Create Course</button>
        </div>
      </section>

      <!-- Course-Students Mapping -->
      <section class="data-section">
        <h3 data-i18n="data_mappings_title">Course-Students Mapping</h3>
        <div class="form-group">
          <label for="mappings-excel" data-i18n="label_mappings_excel">Import from Excel (学号 + 课程编号):</label>
          <input type="file" id="mappings-excel" accept=".xls,.xlsx">
          <button onclick="importCourseStudentMappingsFromExcel()" data-i18n="btn_import_mappings">Import Mappings</button>
          <p class="hint" data-i18n="hint_mapping_excel">Excel columns required: 学号/student_number, 课程编号/course_code. If a student_number or course_code does not exist, the result will include an error for that row — please add them first.</p>
        </div>
        <div class="form-group">
          <label data-i18n="label_manual_create">Manual Create:</label>
          <input type="text" id="map-student-number" placeholder="学号 (student number)">
          <input type="text" id="map-course-code" placeholder="课程编号 (course code)">
          <button onclick="submitNewMapping()" data-i18n="btn_add_mapping">Add Mapping</button>
        </div>
      </section>

      <div id="data-results"></div>
    </div>
  </main>

  <script src="js/i18n.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
